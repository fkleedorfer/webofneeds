@prefix ex: <http://example.org/ns#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix vf:    <https://w3id.org/valueflows#> .
@prefix om2: <http://www.ontology-of-units-of-measure.org/resource/om-2/> .
@prefix wd: <http://www.wikidata.org/entity/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .

@prefix bl: <https://w3id.org/won/blending#> .
@prefix var: <http://example.org/var#> .
@prefix vfsh: <https://w3id.org/valueflows-shacl/shapes#> .

ex:PatternTransferAtLocation-main {
    ex:PatternTransferAtLocation a bl:Blendable ;
    bl:dataGraph ex:PatternTransferAtLocation-data ;
    bl:shapesGraph ex:PatternTransferAtLocation-shapes .
}

ex:PatternTransferAtLocation-data {

    ex:transferAtLocation
        a vf:Intent, bl:BlendingDisabled;
        vf:action vf:transfer ;
        vf:provider var:provider ;
        vf:receiver var:receiver ;
        vf:resourceInventoriedAs var:resource ;
        vf:toResourceInventoriedAs var:toResource ;
        vf:atLocation var:location ;
        vf:resourceQuantity [
            om2:hasUnit var:unit ;
            om2:hasNumericalValue var:value ;
            a bl:BlendingDisabled
        ]
    .

    var:provider
        a bl:Variable ;
        bl:name "provider" .
    var:receiver
         a bl:Variable ;
        bl:name "receiver" .
    var:resource
        a bl:Variable ;
        bl:name "resource" .
    var:toResource
        a bl:Variable ;
        bl:name "toResource" .
    var:location
        a bl:Variable ;
        bl:name "location" .
    var:unit
        a bl:Variable ;
        bl:name "unit" .
    var:value
        a bl:Variable ;
        bl:name "value" .
}

ex:PatternTransferAtLocation-shapes {
    ex:providerShape a sh:NodeShape ;
        sh:targetNode var:provider ;
        sh:class foaf:Agent ;
        sh:deactivated true . # only when the variable is bound, its shape gets activated
    ex:receiverShape a sh:NodeShape ;
        sh:targetNode var:receiver ;
        sh:class foaf:Agent ;
        sh:deactivated true.
    ex:resourceShape a sh:NodeShape ;
        sh:targetNode var:resource ;
        sh:class vf:EconomicResource ;
        sh:deactivated true.
    ex:toResourceShape a sh:NodeShape ;
        sh:targetNode var:toResource ;
        sh:class vf:EconomicResource ;
        sh:deactivated true.
    ex:locationShape a sh:NodeShape ; # locations aren't particularly well restrained yet - needs work
        sh:targetNode var:location ;
        sh:property [
            sh:path [ sh:inversePath vf:currentLocation ] ;
            sh:minCount 1
        ] ;
        sh:deactivated true .
    ex:unitShape a sh:NodeShape ;
        sh:targetNode var:unit ;
        sh:nodeKind sh:IRI ;
        sh:class om2:Unit ;
        sh:deactivated true .
    ex:valueShape a sh:NodeShape ;
        sh:targetNode var:value ;
        sh:or (
                                      [ sh:datatype xsd:int ]
                                      [ sh:datatype xsd:integer ]
                                      [ sh:datatype xsd:double ]
                                      [ sh:datatype xsd:float ]
                                      [ sh:datatype xsd:decimal ]
                                      [ sh:datatype xsd:long ]
                                      [ sh:datatype xsd:short ]
                                  );
        sh:deactivated true .
    ex:quantityShape a sh:NodeShape ;
        sh:targetObjectsOf vf:resourceQuantity;
        sh:node vfsh:QuantityNodeShape .
}


