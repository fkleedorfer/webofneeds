@prefix :        <https://w3id.org/won/ext/group#> .
@prefix dc:      <http://purl.org/dc/elements/1.1/> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix won:     <https://w3id.org/won/core#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix chat:    <https://w3id.org/won/ext/chat#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix vann:    <http://purl.org/vocab/vann/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix auth:    <https://w3id.org/won/auth#> .
@base            <https://w3id.org/won/ext/group> .

###  https://w3id.org/won/ext/group#groupMember

:groupMember
    rdf:type    owl:ObjectProperty ;
    rdfs:domain won:Atom ;
    rdfs:range  won:Atom .


#################################################################
#    Individuals
#################################################################

###  https://w3id.org/won/ext/group#GroupSocket

:GroupSocket
    rdf:type                       owl:NamedIndividual, won:SocketDefinition ;
    won:compatibleSocketDefinition chat:ChatSocket ;
    won:derivesAtomProperty        :groupMember ;
    rdfs:comment                   "Socket for connecting to the Atom as a group member."@en ;
    rdfs:label                     "GroupSocket" ;
# 1. a group allows its members and invitees to
# * view the atom
# * view all other group members
# * request a token confirming that they are member/invitee
    auth:localAuth                 [ a            auth:Authorization ;
                                     auth:grantee [ auth:socket [ auth:socketType :GroupSocket ;
                                                                  auth:connection
                                                                                  [ auth:connectionState won:Connected,
                                                                                                         won:RequestSent ] ] ] ;
                                     auth:grant   [ auth:operation [ auth:requestToken [ auth:tokenScope   :GroupSocket ;
                                                                                         auth:expiresAfter 3600 ] ] ;
                                                    auth:graph
                                                                   [ auth:graphType auth:contentGraph, auth:keyGraph,
                                                                                    auth:sysinfoGraph ;
                                                                     auth:operation auth:opRead ] ;
                                                    auth:socket    [ auth:socketType         :GroupSocket ;
                                                                     auth:operation          auth:opRead ;
                                                                     auth:connectionMessages
                                                                                             [ auth:inherit
                                                                                                     false ] ] ] ] ;
# 2. group asks its members to allow all other group members to read their content graphs
    auth:targetAuth                [ a           auth:Authorization ;
                                     auth:bearer [ auth:tokenScope :GroupSocket ;
                                                   auth:issuer     [ auth:atom auth:authorizationRequestor ] ] ;
                                     auth:grant  [ auth:graph [ auth:graphType auth:contentGraph ;
                                                                auth:operation auth:opRead ] ] ] .


###  https://w3id.org/won/ext/group#groupMember

:groupMember
    rdf:type owl:NamedIndividual .


#################################################################
#    Annotations
#################################################################

:groupMember
    rdfs:comment "Links a group Atom to one of its group members."@en ;
    rdfs:label   "groupMember" .


###  Generated by the OWL API (version 4.5.9.2019-02-01T07:24:44Z) https://github.com/owlcs/owlapi
